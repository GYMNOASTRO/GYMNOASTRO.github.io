<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>rt-PA Dose Calculator</title>
  <style>
    :root{
      --bg: #0b1220;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --border: rgba(255,255,255,.14);
      --shadow: 0 18px 45px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 5%, rgba(114,139,255,.18), transparent 60%),
                  radial-gradient(1200px 800px at 85% 35%, rgba(39,211,190,.14), transparent 60%),
                  var(--bg);
      color: var(--text);
      line-height:1.45;
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 22px 16px 36px;
    }

    /* ===== LOGO ===== */
    .logo-box{
      display:flex;
      justify-content:center;
      margin: 6px 0 12px;
    }
    .logo-box img{
      width: 110px;
      max-width: 40vw;
      height: auto;
      filter: drop-shadow(0 10px 25px rgba(0,0,0,.35));
    }

    header{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-bottom: 16px;
      text-align:center;
    }
    h1{
      margin:0;
      font-size: clamp(20px, 2.2vw, 28px);
      letter-spacing:.2px;
    }
    .sub{
      color: var(--muted);
      font-size: 14px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    @media (min-width: 860px){
      .grid{ grid-template-columns: 360px 1fr; gap: 16px; align-items: start; }
    }
    .card{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .pad{ padding: 16px; }
    .section-title{
      font-weight: 700;
      font-size: 14px;
      letter-spacing:.2px;
      margin: 0 0 10px;
      color: rgba(255,255,255,.9);
    }
    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .input-row{
      display:flex;
      gap:10px;
      align-items:center;
    }
    input[type="number"]{
      width: 100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.20);
      color: var(--text);
      font-size: 16px;
      outline: none;
    }
    input[type="number"]:focus{
      border-color: rgba(114,139,255,.6);
      box-shadow: 0 0 0 4px rgba(114,139,255,.12);
    }
    .unit{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.85);
      font-size: 14px;
      white-space: nowrap;
    }
    .btns{
      display:flex;
      gap:10px;
      margin-top: 12px;
    }
    button{
      appearance:none;
      border:none;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 700;
      cursor:pointer;
      font-size: 14px;
    }
    .primary{
      background: rgba(114,139,255,.95);
      color: #0a1020;
    }
    .ghost{
      background: rgba(255,255,255,.10);
      color: var(--text);
      border: 1px solid var(--border);
    }
    .note{
      margin-top: 12px;
      font-size: 12.5px;
      color: var(--muted);
    }
    .note strong{color: rgba(255,255,255,.85)}
    .pill{
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(39,211,190,.16);
      border: 1px solid rgba(39,211,190,.28);
      color: rgba(255,255,255,.9);
      font-size: 12px;
      margin-top: 10px;
    }
    .results{
      display:grid;
      gap: 10px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      align-items:flex-start;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.16);
    }
    .row .k{
      color: rgba(255,255,255,.88);
      font-size: 14px;
      font-weight: 650;
    }
    .row .v{
      text-align:right;
      font-variant-numeric: tabular-nums;
      font-size: 16px;
      font-weight: 800;
    }
    .muted{
      color: var(--muted);
      font-weight: 600;
      font-size: 12px;
      margin-top: 2px;
    }
    .divider{
      height:1px;
      background: rgba(255,255,255,.10);
      margin: 12px 0;
    }
    .warn{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,183,77,.35);
      background: rgba(255,183,77,.12);
      color: rgba(255,255,255,.92);
      font-size: 13px;
    }
    .footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
    }
    .small{
      font-size: 12px;
      color: var(--muted);
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- LOGO -->
    <div class="logo-box">
      <!-- ใส่ไฟล์โลโก้ชื่อ logosawee.png ไว้โฟลเดอร์เดียวกับไฟล์ html -->
      <img src="logosawee.png" alt="โรงพยาบาลสวี">
    </div>

    <header>
      <h1>rt-PA Dose Calculator</h1>
      <div class="sub">ใส่น้ำหนัก (kg) → คำนวณขนาดยารวม, bolus 10% และ drip 90% พร้อมการดึงยาออกจากขวด</div>
    </header>

    <div class="grid">
      <!-- Input Card -->
      <section class="card">
        <div class="pad">
          <div class="section-title">กรอกข้อมูล</div>

          <label for="weight">น้ำหนักผู้ป่วย</label>
          <div class="input-row">
            <input id="weight" type="number" inputmode="decimal" min="0" step="0.1" placeholder="เช่น 62.5" />
            <div class="unit">kg</div>
          </div>

          <div class="btns">
            <button class="primary" id="calcBtn" type="button">คำนวณ</button>
            <button class="ghost" id="clearBtn" type="button">ล้างค่า</button>
          </div>

          <div class="note">
            เงื่อนไข: ถ้าน้ำหนัก <strong>&gt; 100 kg</strong> จะใช้ค่า <strong>100 kgs</strong> ในการคำนวณทั้งหมด
            <div class="pill" id="capPill" style="display:none;">ใช้ค่าน้ำหนัก 100 kg (cap)</div>
          </div>

          <div class="divider"></div>

          <div class="warn small">
            หมายเหตุ: เครื่องมือนี้คำนวณตามสูตรที่คุณกำหนดเพื่อใช้งานหน้างาน โปรดตรวจสอบความถูกต้องตามแนวทางของหน่วยงาน/โรงพยาบาลก่อนใช้จริง
          </div>
        </div>
      </section>

      <!-- Result Card -->
      <section class="card">
        <div class="pad">
          <div class="section-title">ผลการคำนวณ</div>

          <div id="emptyState" class="small" style="padding:10px 2px;">
            ใส่น้ำหนักแล้วกด “คำนวณ”
          </div>

          <div class="results" id="results" style="display:none;">
            <div class="row">
              <div>
                <div class="k">1) rt-PA ที่ต้องใช้ทั้งหมด</div>
                <div class="muted">สูตร: น้ำหนัก × 0.9</div>
              </div>
              <div class="v"><span id="totalMg">-</span> <span class="small">mg</span></div>
            </div>

            <div class="row">
              <div>
                <div class="k">2) 10% bolus (1 นาที push)</div>
                <div class="muted">สูตร: (น้ำหนัก × 0.9) × 0.1</div>
              </div>
              <div class="v"><span id="bolusMg">-</span> <span class="small">mg</span></div>
            </div>

            <div class="row">
              <div>
                <div class="k">3) 90% drip (60 นาที infusion)</div>
                <div class="muted">สูตร: (น้ำหนัก × 0.9) − bolus</div>
              </div>
              <div class="v"><span id="dripMg">-</span> <span class="small">mg</span></div>
            </div>

            <div class="divider"></div>

            <div class="row">
              <div>
                <div class="k">4) ขวดที่ 1 ดึงยาออก หลัง bolus</div>
                <div class="muted" id="vial1Formula">-</div>
              </div>
              <div class="v"><span id="vial1Mg">-</span> <span class="small">mg</span></div>
            </div>

            <div class="row">
              <div>
                <div class="k">ขวดที่ 2 ดึงยาเพิ่มอีก</div>
                <div class="muted" id="vial2Formula">-</div>
              </div>
              <div class="v"><span id="vial2Mg">-</span> <span class="small">mg</span></div>
            </div>

            <div class="footer" id="logicText"></div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    const weightEl = document.getElementById('weight');
    const calcBtn = document.getElementById('calcBtn');
    const clearBtn = document.getElementById('clearBtn');

    const results = document.getElementById('results');
    const emptyState = document.getElementById('emptyState');

    const totalMgEl = document.getElementById('totalMg');
    const bolusMgEl = document.getElementById('bolusMg');
    const dripMgEl  = document.getElementById('dripMg');
    const vial1MgEl = document.getElementById('vial1Mg');
    const vial2MgEl = document.getElementById('vial2Mg');

    const vial1FormulaEl = document.getElementById('vial1Formula');
    const vial2FormulaEl = document.getElementById('vial2Formula');
    const logicTextEl = document.getElementById('logicText');
    const capPill = document.getElementById('capPill');

    function round2(x){
      return (Math.round((x + Number.EPSILON) * 100) / 100).toFixed(2);
    }

    function toNum(v){
      const n = Number(v);
      return Number.isFinite(n) ? n : NaN;
    }

    function calculate(){
      const rawW = toNum(weightEl.value);

      if (!Number.isFinite(rawW) || rawW <= 0){
        results.style.display = 'none';
        emptyState.style.display = 'block';
        emptyState.textContent = 'กรุณาใส่น้ำหนักเป็นตัวเลขมากกว่า 0';
        capPill.style.display = 'none';
        return;
      }

      // ✅ CAP weight at 100 for all calculations
      const w = rawW > 100 ? 100 : rawW;
      capPill.style.display = (rawW > 100) ? 'inline-block' : 'none';

      // 1) total (mg)
      const total = w * 0.9;

      // 2) bolus (mg)
      const bolus = total * 0.1;

      // 3) drip (mg)
      const drip = total - bolus;

      // ✅ 4) VIAL LOGIC (FIXED: NO /100 anywhere)
      // Vial 1 = 50 - total; if negative show 0
      const vial1 = Math.max(0, (50-bolus)-drip);

      // Vial 2
      const vial2 = (w <= 55.5)
        ? 0
        : (total - bolus) - (50 - bolus); // = total - 50

      // ✅ formulas text
      if (w <= 55.5) {
        vial1FormulaEl.textContent = 'สูตร: (50 − bolus)-Drip';
        vial2FormulaEl.textContent = 'น้ำหนัก ≤ 55.5 kg → ขวดที่ 2 ดึงยาออก 0 mg';
        logicTextEl.textContent = 'เงื่อนไข: น้ำหนัก ≤ 55.5 kg';
      } else {
        vial1FormulaEl.textContent = 'สูตร: (50 − bolus)-Drip';
        vial2FormulaEl.textContent = 'สูตร: ((น้ำหนัก×0.9)−bolus) − (50−bolus)';
        logicTextEl.textContent = 'เงื่อนไข: น้ำหนัก > 55.5 kg และ ≤ 100 kg (ถ้าเกิน 100 kgs ใช้ 100 kgs แทน)';
      }

      // ✅ show results (mg) — IMPORTANT: no divide by 100
      totalMgEl.textContent = round2(total);
      bolusMgEl.textContent = round2(bolus);
      dripMgEl.textContent  = round2(drip);
      vial1MgEl.textContent = round2(vial1);
      vial2MgEl.textContent = round2(vial2);

      emptyState.style.display = 'none';
      results.style.display = 'grid';

      // Debug (ถ้าไม่อยากให้เห็นใน console ลบบรรทัดนี้ได้)
      // console.log({ rawW, w, total, bolus, drip, vial1, vial2 });
    }

    function clearAll(){
      weightEl.value = '';
      results.style.display = 'none';
      emptyState.style.display = 'block';
      emptyState.textContent = 'ใส่น้ำหนักแล้วกด “คำนวณ”';
      capPill.style.display = 'none';
      weightEl.focus();
    }

    calcBtn.addEventListener('click', calculate);
    clearBtn.addEventListener('click', clearAll);

    weightEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') calculate();
    });

    weightEl.addEventListener('input', () => {
      if (weightEl.value.trim() !== '') calculate();
      else clearAll();
    });
  </script>
</body>
</html>
